% Minor updates in v2.5.1: 
% This should include most of the minor updates and bug fixes after v2.5.  
% Please check in once in a while to make sure you are using the most updated version. 
%
% 2013 May 25th: [visualizeSpotMap] 
%	- revise the way it takes in the input variable so that the users can visualize spot map from specified slice to another.
% 2013 May 23rd: [trainRFClassifier]
%	- fix the problem with generating trees with only one node.  
%


% Update Log for spotFindingSuite ver. 2.5:

% Q1: What's new about ver. 2.5?
% - Add in new stats: 
%   * deltaStats:  difference of metric stats (plus sign, star sign, center box) compared to those derived from shuffled pixels.
%   * randStats: P-value of stats such as total area intensity and cumulative percentiles against those from randomly generated 7x7 pixels.
%   * ratioSigmaXY: ratio of sigmaX/sigmaY or sigmaY/sigmaX whichever leaves a ratio smaller than 1. 
% - Change the way of estimating the total spot number and spot number range.
%   It solves the problme of adding up the inaccurate probability estimates generated by decision trees and gives way more accurate estimate of total spot number.
% - classifySpots and trainRFClassifier have built-in version check.  The users only need to redo from trainRFClassifer to classifySpotsOnDirectory.
% - Add in a field called 'locAndClass' in spotStats.mat files. This field contains a n-by-4 double array with n number of spots. 
%   The first three columns designate the x-y-z coordinates of each spot and the last column specifies the final classification of each corresponding spot.
% - Fixed the moving frame problem and max merge image problem in identifySpots.m.
% - Fixed the 'Redo ClassifySpots' button in reviewFISHClassification.m.

% Q2: Where should I start if I just want to redo a data set that I've done before with this new version?
% <Short answer> just use all the familiar commands starting from 
%   trainRFClassifier-->classifySpotsOnDirectory-->reviewFISHClassification-->classifySpotsOnDirectory-->spotStatsDataAligning
%   Iterate between trainRFClassifier and reviewFISHCalssification if necessary.
%
% <Long answer> step-by-step:
% 1. Load in your old trainingSet and retrain the trainingSet:
%
%    >> Load trainingSet_{dye}_{ProbeName}.mat (e.g. Load trainingSet_cy5_Cel_elt2.mat)
%    >> trainingSet=trainRFClassifier(trainingSet)  
%
% * Make sure you don't have the old version in your set path so that Matlab uses the most updated version of trainRFClassifier.
% * If your trainingSet is an old set, trainRFClassifier will not overwrite the old set but create a new trainingSet file named with a '_v2p5' suffix.
%   So make sure you have this new training set before you proceed.
%
% 2. Use the new training set to classify spots.
%
%    >> classifySpotsOnDirectory(1,trainingSet,'dye') (e.g. classifySpotsOnDirectory(1,trainingSet,'cy5'), uses current trainingSet to classify all the cy5 positions on directory.)
%
% 3. Review spot classifcation: 
%   The new version adds some new statistics and should improve the accuracy of the classification. 
%   If your old training set is already working very well, the error rate might not improve a lot but you'll get a more accurate total spot number and spot number range estimate.
%   
%   >> reviewFISHClassification('{dye}_{PositionIdentifier}') (e.g. reviewFISHClassification('cy5_Pos0'), will open up the review GUI for cy5 position 0.)
% 
% 4. (Re-train the classifier if necessary: go back from step 1 to Step 3.)
% 5. Final spot classification: do step 2 again if you did retrain the classifier.
% 6. Aligning spot stats:
%
%   >> spotStatsDataAligning(fileSuffix,alignDapi*) (e.g. spotStatsDataAligning('20130425',1), aligns dapi nuclei data and output a wormData structure)

% Q3: If I've already analyzed some data half way, which part should I redo from?
%   - You DO NOT need to redo createSegImages and doEvalFISHStack.  
%   - You can start from createSpotTrainingSet.
%   - If you've already have an existing trainingSet, just start from trainRFClassifier and follow steps in Q2.

% Scripts/Functions updated:
%   - evalFISHStack.m
%   - createSpotTrainingSet.m   (built-in version check)
%   - trainRFClassifier.m       (built-in version check)
%   - classifySpots.m           (built-in version check)
%   - updateSpotStats.m      
%   - identifySpots.m
%   - createSegImages.m   

% Functions added:
%   - calculateDeltaStats
%   - calculateRandStats
%   - addStatsToTrainingSet
%   - addStatsToWormGaussianFit