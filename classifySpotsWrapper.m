function classifySpotsWrapper()


trainingSets={{'3_1_09_N2_25C_xol1cy5_sdc2tmr','trainingSet_cy_Cel_xol1.mat'},...
    {'3_1_09_N2_25C_xol1cy5_sdc2tmr','trainingSet_tmr_Cel_sdc2.mat'},...
    {'3_2_09_fog2_25C_xol1cy5_sdc2_tmr','trainingSet_cy_Cel_xol1.mat'},...
    {'3_2_09_fog2_25C_xol1cy5_sdc2_tmr','trainingSet_tmr_Cel_sdc2.mat'},...
    {'5_10_09_Sex1Sea1_25C_xol1cy5_sdc2tmr','trainingSet_cy_Cel_xol1.mat'},...
    {'5_10_09_Sex1Sea1_25C_xol1cy5_sdc2tmr','trainingSet_tmr_Cel_sdc2.mat'},...
    {'5_13_09_Sex1Sea1_25C_xol1cy5_sdc2tmr','trainingSet_cy_Cel_xol1.mat'},...
    {'5_13_09_Sex1Sea1_25C_xol1cy5_sdc2tmr','trainingSet_tmr_Cel_sdc2.mat'},...
    {'5_29_09_N2_25C_sex1tmr_xol1cy5','trainingSet_cy_Cel_xol1.mat'},...
    {'5_29_09_N2_25C_sex1tmr_xol1cy5','trainingSet_tmr_Cel_sex1.mat'},...
    {'5_29_09_fog2_25C_sex1tmr_xol1cy5','trainingSet_cy_Cel_xol1.mat'},...
    {'5_29_09_fog2_25C_sex1tmr_xol1cy5','trainingSet_tmr_Cel_sex1.mat'},...
    {'6_11_09_sex1_25C_sdc2tmr_xol1cy5','trainingSet_cy_Cel_xol1.mat'},...
    {'6_11_09_sex1_25C_sdc2tmr_xol1cy5','trainingSet_tmr_Cel_sdc2.mat'},...
    {'6_16_09_fog2_25C_sea1cy5_sex1tmr','trainingSet_cy_Cel_sea1.mat'},...
    {'6_16_09_fog2_25C_sea1cy5_sex1tmr','trainingSet_tmr_Cel_sex1.mat'},...
    {'6_17_09_sex1sea1sea2_25C_sdc2tmr_xol1cy5','trainingSet_cy_Cel_xol1.mat'},...
    {'6_17_09_sex1sea1sea2_25C_sdc2tmr_xol1cy5','trainingSet_tmr_Cel_sdc2.mat'},...
    {'6_23_09_sex1sea1_25C_fox1A594_1_40_ceh39tmr_1_40_PFSrun','trainingSet_tmr_Cel_ceh39.mat'},...
    {'6_4_09_sex1_25C_sdc2tmr_xol1cy5','trainingSet_cy_Cel_xol1.mat'},...
    {'6_4_09_sex1_25C_sdc2tmr_xol1cy5','trainingSet_tmr_Cel_sdc2.mat'},...
    {'6_4_09_sex1_25C_sex1tmr_xol1cy5','trainingSet_cy_Cel_xol1.mat'},...
    {'6_4_09_sex1_25C_sex1tmr_xol1cy5','trainingSet_tmr_Cel_sex1.mat'},...
    {'7_10_09_N2_25C_fox1A594_sea1cy5_sdc2tmr','trainingSet_alexa_Cel_fox1.mat'},...
    {'7_10_09_N2_25C_fox1A594_sea1cy5_sdc2tmr','trainingSet_cy_Cel_sea1.mat'},...
    {'7_10_09_N2_25C_fox1A594_sea1cy5_sdc2tmr','trainingSet_tmr_Cel_sdc2.mat'},...
    {'7_2_09_sex1sea1_25C_fox1alexa_sea1cy5_ceh39tmr','trainingSet_cy_Cel_sea1.mat'},...
    {'7_3_09_N2_25C_sea2alexa_xol1cy5_sex1tmr','trainingSet_alexa_Cel_sea2.mat'},...
    {'7_3_09_N2_25C_sea2alexa_xol1cy5_sex1tmr','trainingSet_cy_Cel_xol1.mat'},...
    {'7_3_09_N2_25C_sea2alexa_xol1cy5_sex1tmr','trainingSet_tmr_Cel_sex1.mat'},...
    {'7_3_09_N2_25C_xol1cy5_sea1A594_sdc2tmr_1_10','trainingSet_alexa_Cel_sea1.mat'},...
    {'7_3_09_N2_25C_xol1cy5_sea1A594_sdc2tmr_1_10','trainingSet_cy_Cel_xol1.mat'},...
    {'7_3_09_N2_25C_xol1cy5_sea1A594_sdc2tmr_1_10','trainingSet_tmr_Cel_sdc2.mat'},...
    {'7_4_09_N2_25C_sea1A594_fox1cy5_ceh39tmr','trainingSet_alexa_Cel_sea1.mat'},...
    {'7_4_09_N2_25C_sea1A594_fox1cy5_ceh39tmr','trainingSet_cy_Cel_fox1.mat'},...
    {'7_4_09_N2_25C_sea1A594_fox1cy5_ceh39tmr','trainingSet_tmr_Cel_ceh39.mat'},...
    {'7_5_09_fog2_25C_xol1cy5_sdc2A594_1_5_sex1IItmr_1_40_PFSrun','trainingSet_alexa_Cel_sdc2.mat'},...
    {'7_5_09_fog2_25C_xol1cy5_sdc2A594_1_5_sex1IItmr_1_40_PFSrun','trainingSet_cy_Cel_xol1.mat'},...
    {'more7_5_09_fog2_25C_xol1cy5_sdc2A594_1_5_sex1IItmr_1_40_PFSrun','trainingSet_alexa_Cel_sdc2.mat'},...
    {'more7_5_09_fog2_25C_xol1cy5_sdc2A594_1_5_sex1IItmr_1_40_PFSrun','trainingSet_cy_Cel_xol1.mat'}};


%go through all directories: start in SexDet
SexDetDir='/Volumes/rifkinlab/sarifkin/Projects/Worms/SexDet/';
cd(SexDetDir);
dirs=dir;

for iDir=1:length(dirs)
    
    if dirs(iDir).isdir && ~strcmp(dirs(iDir).name(1),'.')
        
        cd(dirs(iDir).name);
        disp(['Entering ' dirs(iDir).name]);
        tss=dir('trainingSet*mat');
        if ~isempty(tss)
            for iTS=1:length(tss)
                try
                    for iTSCheck=1:length(trainingSets)
                        if strcmp(dirs(iDir).name,trainingSets{iTSCheck}{1})
                            if strcmp(tss(iTS).name,trainingSets{iTSCheck}{2})
                                dye=regexp(tss(iTS).name,'_','split');
                                dye=dye{2};
                                ts=load(tss(iTS).name);
                                disp('*********************************');
                                disp(['Classifying spots for ' tss(iTS).name ' with dye ' dye]);
                                tic
                                classifySpotsOnDirectory(1,ts.trainingSet,dye);
                                disp(toc);
                                disp('Done');
                                break
                            end;
                        end;
                    end;
                catch ME
                    %parsaveProblem(ME);
                    disp(['******** PROBLEM in ' dirs(iDir).name ' in ' tss(iTS).name ' with dye ' dye]);
                end;
            end;
        else
            disp(['No trainingSets in ' dirs(iDir).name]);
        end;
    end;
    
    cd(SexDetDir);
end;

end


%%
function parsaveProblem(error)
save('PROBLEM.mat','error');
end